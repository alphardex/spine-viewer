<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spine Viewer Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .demo-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .demo-card h3 {
        margin-top: 0;
        color: #333;
      }

      spine-viewer {
        width: 100%;
        height: 300px;
        border: 2px solid #eee;
        border-radius: 8px;
        display: block;
        margin: 10px 0;
      }

      .controls {
        margin-top: 10px;
      }

      .controls button {
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        margin-right: 10px;
        cursor: pointer;
      }

      .controls button:hover {
        background: #5a6fd8;
      }

      .controls input {
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
      }

      .controls input[type="url"] {
        box-sizing: border-box;
        background: white;
        padding: 8px;
        border: 2px solid #667eea;
        border-radius: 6px;
        width: 100%;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .controls input[type="url"]:focus {
        border-color: #5a6fd8;
        outline: none;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
      }

      .controls select {
        background: white;
        padding: 8px;
        border: 2px solid #667eea;
        border-radius: 6px;
        font-size: 14px;
        margin-right: 10px;
        cursor: pointer;
      }

      .controls select:focus {
        border-color: #5a6fd8;
        outline: none;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
      }

      #upload-status {
        margin-top: 10px;
        padding: 8px;
        border-radius: 4px;
        font-size: 14px;
      }

      .status-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .code-example {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .code-example h3 {
        margin-top: 0;
        color: #495057;
      }

      pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 10px 0;
      }

      code {
        font-family: "Courier New", monospace;
      }

      .disclaimer {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        color: #856404;
      }

      .disclaimer p {
        margin: 0;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>🎮 Spine Viewer Demo</h1>

      <div class="demo-grid">
        <div class="demo-card">
          <h3>基础用法</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer1"
          >
          </spine-viewer>
          <div class="controls"></div>
        </div>

        <div class="demo-card">
          <h3>不同缩放</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            scale="0.4"
            id="viewer2"
          >
          </spine-viewer>
          <div class="controls">
            <input
              type="range"
              min="0.1"
              max="1.0"
              step="0.1"
              value="0.4"
              onchange="changeScale('viewer2', this.value)"
            />
            <span>缩放: <span id="scale-value">0.4</span></span>
          </div>
        </div>

        <div class="demo-card">
          <h3>动态控制</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer3"
          >
          </spine-viewer>
          <div class="controls">
            <button onclick="listAnimations('viewer3')">列出动画</button>
            <button onclick="randomAnimation('viewer3')">随机动画</button>
          </div>
          <div id="animation-list"></div>
        </div>

        <div class="demo-card">
          <h3>切换Spine</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer4"
          >
          </spine-viewer>
          <div class="controls">
            <input type="url" id="spine-url" placeholder="请输入Spine文件路径 (如: /mafuyu/sd_main.skel)" />
            <button onclick="loadSpineFromUrl()">加载Spine</button>
            <select id="character-select" onchange="selectCharacter()">
              <option value="">选择Spine</option>
              <option value="kanade">宵崎奏 (Kanade)</option>
              <option value="mafuyu">朝比奈真冬 (Mafuyu)</option>
              <option value="ena">東雲絵名 (Ena)</option>
              <option value="mizuki">暁山瑞希 (Mizuki)</option>
            </select>
            <button onclick="resetToDefault()">重置为默认</button>
          </div>
          <div id="upload-status"></div>
        </div>
      </div>

      <div class="code-example">
        <h3>📝 使用方法</h3>
        <p>首先引入 Spine Viewer 组件：</p>
        <pre><code>&lt;script type="module" src="./spine-viewer.js"&gt;&lt;/script&gt;</code></pre>

        <p>然后在HTML中使用：</p>
        <pre><code>&lt;spine-viewer 
    src="/kanade/sd_main.skel" 
    animation-name="w_pure_idle01_f" 
    scale="0.4"&gt;
&lt;/spine-viewer&gt;</code></pre>

        <p>JavaScript API：</p>
        <pre><code>const viewer = document.querySelector('spine-viewer');

// 设置动画
viewer.setAnimation('w_pure_idle01_f', true);

// 设置缩放
viewer.setScale(0.4);

// 获取所有动画列表
const animations = viewer.getAnimations();

// 切换Spine
viewer.renderSpine({
  src: "/mafuyu/sd_main.skel",
  animationName: "w_pure_idle01_f",
});
</code></pre>

        <h4>属性说明：</h4>
        <ul>
          <li><strong>src</strong>: Spine .skel 文件路径</li>
          <li><strong>animation-name</strong>: 要播放的动画名称</li>
          <li><strong>scale</strong>: 缩放比例</li>
        </ul>
      </div>

      <div class="disclaimer">
        <p>本网站用到的Spine动画来源于sekai.best，所有版权归其合法所有者所有，包括但不限于 Sega、Colorful Palette 和 Crypton。本网站所有内容仅供学习和研究目的，以便让更多的人了解和熟悉Spine动画技术。</p>
      </div>
    </div>

    <script type="module">
      // import "../dist/index.esm.js";
      import "@alphardex/spine-viewer";
    </script>
    <script>
      function changeAnimation(viewerId, animationName) {
        const viewer = document.getElementById(viewerId);
        viewer.setAnimation(animationName);
      }

      function changeScale(viewerId, scale) {
        const viewer = document.getElementById(viewerId);
        viewer.setScale(parseFloat(scale));

        // 更新显示的缩放值
        const scaleDisplay = document.getElementById("scale-value");
        if (scaleDisplay) {
          scaleDisplay.textContent = scale;
        }
      }

      function listAnimations(viewerId) {
        const viewer = document.getElementById(viewerId);
        const animations = viewer.getAnimations();
        const listElement = document.getElementById("animation-list");

        if (animations.length > 0) {
          listElement.innerHTML =
            "<h4>可用动画:</h4><ul style='max-height:10rem;overflow-y:auto;'>" +
            animations
              .map(
                (anim) =>
                  `<li><button onclick="changeAnimation('${viewerId}', '${anim}')">${anim}</button></li>`
              )
              .join("") +
            "</ul>";
        } else {
          listElement.innerHTML = "<p>暂无动画数据</p>";
        }
      }

      function randomAnimation(viewerId) {
        const viewer = document.getElementById(viewerId);
        const animations = viewer.getAnimations();

        if (animations.length > 0) {
          const randomAnim =
            animations[Math.floor(Math.random() * animations.length)];
          viewer.setAnimation(randomAnim);
        }
      }

      function loadSpineFromUrl() {
        const urlInput = document.getElementById('spine-url');
        const statusElement = document.getElementById('upload-status');
        const spineUrl = urlInput.value.trim();
        
        if (!spineUrl) {
          statusElement.className = 'status-error';
          statusElement.textContent = '请输入Spine文件路径';
          return;
        }

        // 检查文件扩展名
        const validExtensions = ['.skel', '.json'];
        const hasValidExtension = validExtensions.some(ext => spineUrl.toLowerCase().includes(ext));
        
        if (!hasValidExtension) {
          statusElement.className = 'status-error';
          statusElement.textContent = '路径应该指向 .skel 或 .json 格式的Spine文件';
          return;
        }

        statusElement.className = 'status-info';
        statusElement.textContent = '正在加载Spine文件...';

        const viewer = document.getElementById('viewer4');

        try {
          // 尝试加载新的Spine文件
          viewer.renderSpine({
            src: spineUrl,
          });

          statusElement.className = 'status-success';
          statusElement.textContent = `Spine文件加载成功！`;
        } catch (error) {
          statusElement.className = 'status-error';
          statusElement.textContent = `加载失败: ${error.message}`;
          console.error('Spine加载错误:', error);
        }
      }

      function resetToDefault() {
        const viewer = document.getElementById('viewer4');
        const statusElement = document.getElementById('upload-status');
        const urlInput = document.getElementById('spine-url');
        
        // 重置为默认Spine
        viewer.renderSpine({
          src: "/kanade/sd_main.skel",
          animationName: "w_pure_idle01_f"
        });
        
        // 清空URL输入和状态
        urlInput.value = '';
        statusElement.className = 'status-info';
        statusElement.textContent = '已重置为默认Spine文件';
        
        // 3秒后清除状态信息
        setTimeout(() => {
          statusElement.textContent = '';
          statusElement.className = '';
        }, 3000);
      }

      function selectCharacter() {
        const select = document.getElementById('character-select');
        const urlInput = document.getElementById('spine-url');
        const character = select.value;
        
        if (character) {
          urlInput.value = `/${character}/sd_main.skel`;
          // 自动加载选中的角色
          loadSpineFromUrl();
        }
      }
    </script>
  </body>
</html>
