<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spine Viewer Demo</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .demo-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .demo-card h3 {
        margin-top: 0;
        color: #333;
      }

      spine-viewer {
        width: 100%;
        height: 300px;
        border: 2px solid #eee;
        border-radius: 8px;
        display: block;
        margin: 10px 0;
      }

      .controls {
        margin-top: 10px;
      }

      .controls button {
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        margin-right: 10px;
        cursor: pointer;
      }

      .controls button:hover {
        background: #5a6fd8;
      }

      .controls input {
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
      }

      .controls input[type="url"] {
        box-sizing: border-box;
        background: white;
        padding: 8px;
        border: 2px solid #667eea;
        border-radius: 6px;
        width: 100%;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .controls input[type="url"]:focus {
        border-color: #5a6fd8;
        outline: none;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
      }

      .controls select {
        background: white;
        padding: 8px;
        border: 2px solid #667eea;
        border-radius: 6px;
        font-size: 14px;
        margin-right: 10px;
        cursor: pointer;
      }

      .controls select:focus {
        border-color: #5a6fd8;
        outline: none;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
      }

      #upload-status {
        margin-top: 10px;
        padding: 8px;
        border-radius: 4px;
        font-size: 14px;
      }

      .status-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .code-example {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
      }

      .code-example h3 {
        margin-top: 0;
        color: #495057;
      }

      pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 10px 0;
      }

      code {
        font-family: "Courier New", monospace;
      }

      .disclaimer {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        color: #856404;
      }

      .disclaimer p {
        margin: 0;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ® Spine Viewer Demo</h1>

      <div class="demo-grid">
        <div class="demo-card">
          <h3>åŸºç¡€ç”¨æ³•</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer1"
          >
          </spine-viewer>
          <div class="controls"></div>
        </div>

        <div class="demo-card">
          <h3>ä¸åŒç¼©æ”¾</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            scale="0.4"
            id="viewer2"
          >
          </spine-viewer>
          <div class="controls">
            <input
              type="range"
              min="0.1"
              max="1.0"
              step="0.1"
              value="0.4"
              onchange="changeScale('viewer2', this.value)"
            />
            <span>ç¼©æ”¾: <span id="scale-value">0.4</span></span>
          </div>
        </div>

        <div class="demo-card">
          <h3>åŠ¨æ€æ§åˆ¶</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer3"
          >
          </spine-viewer>
          <div class="controls">
            <button onclick="listAnimations('viewer3')">åˆ—å‡ºåŠ¨ç”»</button>
            <button onclick="randomAnimation('viewer3')">éšæœºåŠ¨ç”»</button>
          </div>
          <div id="animation-list"></div>
        </div>

        <div class="demo-card">
          <h3>åˆ‡æ¢Spine</h3>
          <spine-viewer
            src="/kanade/sd_main.skel"
            animation-name="w_pure_idle01_f"
            id="viewer4"
          >
          </spine-viewer>
          <div class="controls">
            <input type="url" id="spine-url" placeholder="è¯·è¾“å…¥Spineæ–‡ä»¶è·¯å¾„ (å¦‚: /mafuyu/sd_main.skel)" />
            <button onclick="loadSpineFromUrl()">åŠ è½½Spine</button>
            <select id="character-select" onchange="selectCharacter()">
              <option value="">é€‰æ‹©Spine</option>
              <option value="kanade">å®µå´å¥ (Kanade)</option>
              <option value="mafuyu">æœæ¯”å¥ˆçœŸå†¬ (Mafuyu)</option>
              <option value="ena">æ±é›²çµµå (Ena)</option>
              <option value="mizuki">æšå±±ç‘å¸Œ (Mizuki)</option>
            </select>
            <button onclick="resetToDefault()">é‡ç½®ä¸ºé»˜è®¤</button>
          </div>
          <div id="upload-status"></div>
        </div>
      </div>

      <div class="code-example">
        <h3>ğŸ“ ä½¿ç”¨æ–¹æ³•</h3>
        <p>é¦–å…ˆå¼•å…¥ Spine Viewer ç»„ä»¶ï¼š</p>
        <pre><code>&lt;script type="module" src="./spine-viewer.js"&gt;&lt;/script&gt;</code></pre>

        <p>ç„¶ååœ¨HTMLä¸­ä½¿ç”¨ï¼š</p>
        <pre><code>&lt;spine-viewer 
    src="/kanade/sd_main.skel" 
    animation-name="w_pure_idle01_f" 
    scale="0.4"&gt;
&lt;/spine-viewer&gt;</code></pre>

        <p>JavaScript APIï¼š</p>
        <pre><code>const viewer = document.querySelector('spine-viewer');

// è®¾ç½®åŠ¨ç”»
viewer.setAnimation('w_pure_idle01_f', true);

// è®¾ç½®ç¼©æ”¾
viewer.setScale(0.4);

// è·å–æ‰€æœ‰åŠ¨ç”»åˆ—è¡¨
const animations = viewer.getAnimations();

// åˆ‡æ¢Spine
viewer.renderSpine({
  src: "/mafuyu/sd_main.skel",
  animationName: "w_pure_idle01_f",
});
</code></pre>

        <h4>å±æ€§è¯´æ˜ï¼š</h4>
        <ul>
          <li><strong>src</strong>: Spine .skel æ–‡ä»¶è·¯å¾„</li>
          <li><strong>animation-name</strong>: è¦æ’­æ”¾çš„åŠ¨ç”»åç§°</li>
          <li><strong>scale</strong>: ç¼©æ”¾æ¯”ä¾‹</li>
        </ul>
      </div>

      <div class="disclaimer">
        <p>æœ¬ç½‘ç«™ç”¨åˆ°çš„SpineåŠ¨ç”»æ¥æºäºsekai.bestï¼Œæ‰€æœ‰ç‰ˆæƒå½’å…¶åˆæ³•æ‰€æœ‰è€…æ‰€æœ‰ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Segaã€Colorful Palette å’Œ Cryptonã€‚æœ¬ç½‘ç«™æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œä»¥ä¾¿è®©æ›´å¤šçš„äººäº†è§£å’Œç†Ÿæ‚‰SpineåŠ¨ç”»æŠ€æœ¯ã€‚</p>
      </div>
    </div>

    <script type="module">
      // import "../dist/index.esm.js";
      import "@alphardex/spine-viewer";
    </script>
    <script>
      function changeAnimation(viewerId, animationName) {
        const viewer = document.getElementById(viewerId);
        viewer.setAnimation(animationName);
      }

      function changeScale(viewerId, scale) {
        const viewer = document.getElementById(viewerId);
        viewer.setScale(parseFloat(scale));

        // æ›´æ–°æ˜¾ç¤ºçš„ç¼©æ”¾å€¼
        const scaleDisplay = document.getElementById("scale-value");
        if (scaleDisplay) {
          scaleDisplay.textContent = scale;
        }
      }

      function listAnimations(viewerId) {
        const viewer = document.getElementById(viewerId);
        const animations = viewer.getAnimations();
        const listElement = document.getElementById("animation-list");

        if (animations.length > 0) {
          listElement.innerHTML =
            "<h4>å¯ç”¨åŠ¨ç”»:</h4><ul style='max-height:10rem;overflow-y:auto;'>" +
            animations
              .map(
                (anim) =>
                  `<li><button onclick="changeAnimation('${viewerId}', '${anim}')">${anim}</button></li>`
              )
              .join("") +
            "</ul>";
        } else {
          listElement.innerHTML = "<p>æš‚æ— åŠ¨ç”»æ•°æ®</p>";
        }
      }

      function randomAnimation(viewerId) {
        const viewer = document.getElementById(viewerId);
        const animations = viewer.getAnimations();

        if (animations.length > 0) {
          const randomAnim =
            animations[Math.floor(Math.random() * animations.length)];
          viewer.setAnimation(randomAnim);
        }
      }

      function loadSpineFromUrl() {
        const urlInput = document.getElementById('spine-url');
        const statusElement = document.getElementById('upload-status');
        const spineUrl = urlInput.value.trim();
        
        if (!spineUrl) {
          statusElement.className = 'status-error';
          statusElement.textContent = 'è¯·è¾“å…¥Spineæ–‡ä»¶è·¯å¾„';
          return;
        }

        // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
        const validExtensions = ['.skel', '.json'];
        const hasValidExtension = validExtensions.some(ext => spineUrl.toLowerCase().includes(ext));
        
        if (!hasValidExtension) {
          statusElement.className = 'status-error';
          statusElement.textContent = 'è·¯å¾„åº”è¯¥æŒ‡å‘ .skel æˆ– .json æ ¼å¼çš„Spineæ–‡ä»¶';
          return;
        }

        statusElement.className = 'status-info';
        statusElement.textContent = 'æ­£åœ¨åŠ è½½Spineæ–‡ä»¶...';

        const viewer = document.getElementById('viewer4');

        try {
          // å°è¯•åŠ è½½æ–°çš„Spineæ–‡ä»¶
          viewer.renderSpine({
            src: spineUrl,
          });

          statusElement.className = 'status-success';
          statusElement.textContent = `Spineæ–‡ä»¶åŠ è½½æˆåŠŸï¼`;
        } catch (error) {
          statusElement.className = 'status-error';
          statusElement.textContent = `åŠ è½½å¤±è´¥: ${error.message}`;
          console.error('SpineåŠ è½½é”™è¯¯:', error);
        }
      }

      function resetToDefault() {
        const viewer = document.getElementById('viewer4');
        const statusElement = document.getElementById('upload-status');
        const urlInput = document.getElementById('spine-url');
        
        // é‡ç½®ä¸ºé»˜è®¤Spine
        viewer.renderSpine({
          src: "/kanade/sd_main.skel",
          animationName: "w_pure_idle01_f"
        });
        
        // æ¸…ç©ºURLè¾“å…¥å’ŒçŠ¶æ€
        urlInput.value = '';
        statusElement.className = 'status-info';
        statusElement.textContent = 'å·²é‡ç½®ä¸ºé»˜è®¤Spineæ–‡ä»¶';
        
        // 3ç§’åæ¸…é™¤çŠ¶æ€ä¿¡æ¯
        setTimeout(() => {
          statusElement.textContent = '';
          statusElement.className = '';
        }, 3000);
      }

      function selectCharacter() {
        const select = document.getElementById('character-select');
        const urlInput = document.getElementById('spine-url');
        const character = select.value;
        
        if (character) {
          urlInput.value = `/${character}/sd_main.skel`;
          // è‡ªåŠ¨åŠ è½½é€‰ä¸­çš„è§’è‰²
          loadSpineFromUrl();
        }
      }
    </script>
  </body>
</html>
